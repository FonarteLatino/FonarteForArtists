/*! artistconnect-ui#2042.9.0 */
(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{1000:function(t,e,r){"use strict";var n=r(7),o=r.n(n),i=r(0),a=r.n(i),s=r(5),l=r.n(s),c=r(3),u=r.n(c),p=r(8),h=r.n(p),d=r(4),f=r.n(d),g=r(1),m=r.n(g),v=r(11),y=r(72),S=r(20),b=r.n(S),k=r(1010),C=r.n(k);r(1001);function $(t){return($="function"==typeof a.a&&"symbol"==typeof o.a?function(t){return typeof t}:function(t){return t&&"function"==typeof a.a&&t.constructor===a.a&&t!==a.a.prototype?"symbol":typeof t})(t)}function T(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),l()(t,n.key,n)}}function w(t,e){return!e||"object"!==$(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function _(t){return(_=f.a?u.a:function(t){return t.__proto__||u()(t)})(t)}function z(t,e){return(z=f.a||function(t,e){return t.__proto__=e,t})(t,e)}C()(m.a,y,b.a);var I,P={weekday:"long",year:"numeric",month:"long",day:"numeric"},M={weekday:"short",year:"numeric",month:"short",day:"numeric"},D=(I="vi",function(t){return new RegExp("^".concat(I,"[-_]?"),"i").test(t)}),L=function(t,e){return new Date(e.year(),e.month(),e.date(),e.hours(),e.minutes(),e.seconds()).toLocaleDateString(t,function(t){return D(t)?P:M}(t))},R=function(t){function e(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),w(this,_(e).apply(this,arguments))}var r,n,o;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=h()(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&z(t,e)}(e,v["a"]),r=e,o=[{key:"$inject",get:function(){return["$scope","$timeout","$filter","$injector","TidbitsL10nService"]}}],(n=[{key:"$onInit",value:function(){var t=this,e=this.TidbitsL10nService;this.itemFormatter=this.itemFormatter.bind(this),this.timeseriesOpts={margin:{top:20,right:0,bottom:53,left:0},firstDayOfWeek:1,axes:[{name:"x",options:{grid:!1,stripe:"weekend",stripeColor:"#f8fcfc",tickPadding:18,formatters:{daily:{major:"%b"}}}},{name:"y",options:{tickCount:4,tickFormatter:function(t){var r=e.lang;return r&&"en"===r.substr(0,2)&&t>=100?this.constructor._defaults.tickFormatter.call(this,t):0===Math.abs(t)?"":e.localizeNumber(t)}}}],renderers:[{name:"line",options:{interpolateNulls:!1}},{name:"point",options:{radius:3,hoverRadius:4.5,strokeWidth:2,hoverStrokeWidth:2,fillColor:"#fff",hoverFillColor:"#fff",hoverStrokeColor:"auto"}}],plugins:["hitareas","mask",{name:"tooltip",options:{position:"right",formatter:function(e){return'\n                            <div class="tb-timeseries__tooltip__header">\n                                <span class="tb-timeseries__tooltip__header__date">\n                                    <span class="tb-timeseries__tooltip__header__date__day">\n                                        '.concat("weekly"===t.selectedGranularity.value?t.TidbitsL10nService.localize("trends.weekStartingOn",{"@@date@@":L(t.TidbitsL10nService.lang,b.a.utc(e.date))}):"monthly"===t.selectedGranularity.value?t.TidbitsL10nService.localize("trends.monthStartingOn",{"@@date@@":L(t.TidbitsL10nService.lang,b.a.utc(e.date))}):L(t.TidbitsL10nService.lang,b.a.utc(e.date)),'\n                                    </span>\n                                </span>\n                                <span class="tb-timeseries__tooltip__header__metric">\n                                    ').concat(t.metric||"",'\n                                </span>\n                            </div>\n                            <ul class="tb-timeseries__tooltip__list">\n                                ').concat(e.points.map(t.itemFormatter).join(""),"\n                            </ul>\n                        ")}}},{name:"cursor",options:{strokeColor:"#53585F",strokeWidth:1}}]},this.$scope.$on("DATA_LOADED",function(e,r){if(r&&r.data){var n=r.data.filter(function(t){return t.isVisible});t.filteredData={data:n,options:r.options}}}),this.$scope.$on("URL_UPDATE",function(){t.timeseries&&t.timeseries.setAbsoluteIRI()})}},{key:"itemFormatter",value:function(t){return'\n            <li>\n                <i style="background-color:'.concat(t.color,'"></i>\n                <span>').concat(this.$filter("limitTo")(t.displayName,50)).concat(t.displayName.length>50?"&hellip;":"","</span>\n                <b>").concat(this.$filter("tbLocalizeNumber")(t.tooltipValue),"</b>\n            </li>\n        ")}}])&&T(r.prototype,n),o&&T(r,o),e}();t=m.a.module("artistconnect-ui.deferredTimeseries",["tidbits-timeseries"]);r(1002),t.component("timeseriesContainer",{templateUrl:"common/deferred/timeseriesContainer.html",bindings:{periodNav:"=?",showFilters:"=?",filters:"=",granularities:"<",selectedGranularity:"=?",metric:"<"},controller:R})},1001:function(t,e){var r,n=window.angular;try{r=n.module(["ng"])}catch(s){r=n.module("ng",[])}var o='<div class="timeseries-container">\n<div class="container-spinner"></div>\n<div class="timeseries-container__wrapper">\n<span ng-if="$ctrl.periodNav.canNavPrevious && $ctrl.filteredData" ng-click="$ctrl.periodNav.goPreviousPeriod()" class="timeseries-container__arrow timeseries-container__arrow--back"></span>\n<tidbits-timeseries timeseries="$ctrl.timeseries" data="$ctrl.filteredData" options="$ctrl.timeseriesOpts" highlights="$ctrl.highlights">\n</tidbits-timeseries>\n<span ng-if="$ctrl.periodNav.canNavNext && $ctrl.filteredData" class="timeseries-container__arrow timeseries-container__arrow--forward" ng-click="$ctrl.periodNav.goNextPeriod()"></span>\n<timeseries-options granularities="$ctrl.granularities" selected-granularity="$ctrl.selectedGranularity">\n</timeseries-options>\n</div>\n</div>\n',i="common/deferred/timeseriesContainer.html",a=n.element(window.document).injector();a?a.get("$templateCache").put(i,o):r.run(["$templateCache",function(t){t.put(i,o)}]),t.exports=o},1002:function(t,e,r){"use strict";r.r(e);var n=r(1),o=r.n(n),i=(r(1003),o.a.module("artistconnect-ui.deferredTimeseries").controller("timeseriesOptionsController",[function(){var t=this;this.onSelect=function(e){e.isDisabled||(t.selectedGranularity=e,t.popover.hide())}}]).component("timeseriesOptions",{bindings:{granularities:"<",popover:"=?",selectedGranularity:"=?"},templateUrl:"common/deferred/timeseriesOptions.html",controller:"timeseriesOptionsController as $ctrl"}));e.default=i},1003:function(t,e){var r,n=window.angular;try{r=n.module(["ng"])}catch(s){r=n.module("ng",[])}var o='<tidbits-popover self="$ctrl.popover">\n<div class="tb-popover__clickarea">\n<span class="tb-icon--more"></span>\n</div>\n<div class="tb-popover__content">\n<ul class="tb-list--no-bullet">\n<li ng-repeat="g in $ctrl.granularities" ng-class="{\n                    \'tb-icon--checkmark\': $ctrl.selectedGranularity.value === g.value,\n                    \'disabled\': g.isDisabled\n                }" ng-click="$ctrl.onSelect(g)">\n{{g.title}}\n</li>\n</ul>\n</div>\n</tidbits-popover>\n',i="common/deferred/timeseriesOptions.html",a=n.element(window.document).injector();a?a.get("$templateCache").put(i,o):r.run(["$templateCache",function(t){t.put(i,o)}]),t.exports=o},1004:function(t,e,r){"use strict";var n=r(7),o=r.n(n),i=r(0),a=r.n(i),s=r(57),l=r.n(s),c=r(58),u=r.n(c),p=r(29),h=r.n(p),d=r(5),f=r.n(d),g=r(3),m=r.n(g),v=r(8),y=r.n(v),S=r(4),b=r.n(S),k=r(1),C=r.n(k),$=r(11),T=r(72),w=r(1011),_=r.n(w);r(1005);function z(t){return(z="function"==typeof a.a&&"symbol"==typeof o.a?function(t){return typeof t}:function(t){return t&&"function"==typeof a.a&&t.constructor===a.a&&t!==a.a.prototype?"symbol":typeof t})(t)}function I(t){return function(t){if(h()(t)){for(var e=0,r=new Array(t.length);e<t.length;e++)r[e]=t[e];return r}}(t)||function(t){if(u()(Object(t))||"[object Arguments]"===Object.prototype.toString.call(t))return l()(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function P(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),f()(t,n.key,n)}}function M(t,e){return!e||"object"!==z(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function D(t){return(D=b.a?m.a:function(t){return t.__proto__||m()(t)})(t)}function L(t,e){return(L=b.a||function(t,e){return t.__proto__=e,t})(t,e)}_()(C.a,T);var R=function(t){function e(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),M(this,D(e).apply(this,arguments))}var r,n,o;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=y()(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&L(t,e)}(e,$["a"]),r=e,o=[{key:"$inject",get:function(){return["$log","$scope","$stateParams","$state","KPIService","MapService","$timeout"]}}],(n=[{key:"$onInit",value:function(){var t=this,e=[2,15];this.mapConfig=C.a.merge({assetRoot:"/a/static/maps",scale:180,markerConfig:{activeFillColor:"#D60017",fillColor:"#c1e98d",enterMs:750,size:e,easeScale:"easeQuadInOut",sizeScale:this.scaleMarkerSize.bind(this),colorScale:this.scaleMarkerColor.bind(this),durationScale:function(e){return t.scaleDuration(e)}},tooltipConfig:{onMouseEnter:function(e){return t.onTooltipMouseEnter(e)},edgeMargin:{top:this.getTooltipTopMargin(this.mode),left:0,bottom:0,right:0},debugBoxes:!1},zoomConfig:{zoomMs:1750,zoomByButtonMs:50,zoomRangeRestriction:[1,100]}},this.mapConfig),this.sizeScaleParams=C.a.merge({range:e,RT:35,DT:90,topN:10,useTopN:!0,exponent:1},this.sizeScaleParams),this.colorScaleParams=C.a.merge({colors:[{fill:"rgba(2,155,186,0.9)",hover:"rgba(2,155,186,1)",percentile:1},{fill:"rgba(5,159,189,0.8)",hover:"rgba(5,159,189,1)",percentile:2},{fill:"rgba(5,156,189,0.7)",hover:"rgba(5,156,189,1)",percentile:3},{fill:"rgba(23,170,199,0.7)",hover:"rgba(23,170,199,1)",percentile:5},{fill:"rgba(34,194,227,0.7)",hover:"rgba(34,194,227,1)",percentile:8},{fill:"rgba(9,182,217,0.5)",hover:"rgba(9,182,217,1)",percentile:13},{fill:"rgba(9,182,217,0.4)",hover:"rgba(9,182,217,1)",percentile:21},{fill:"rgba(9,182,217,0.4)",hover:"rgba(9,182,217,1)",percentile:34},{fill:"rgba(9,182,217,0.4)",hover:"rgba(9,182,217,1)",percentile:55},{fill:"rgba(9,182,217,0.3)",hover:"rgba(9,182,217,1)",percentile:100}]},this.colorScaleParams),this.setupWatches()}},{key:"getTooltipTopMargin",value:function(t){var e=50;return"territory"!==t&&(e=400),e}},{key:"setupWatches",value:function(){var t=this;this.$scope.$watch("$ctrl.markers",function(e){t.generateMarkerSizeScales(e),t.generateMarkerColorScales(e)}),this.$scope.$watch("$ctrl.mode",function(e){t.tidbitsGeo&&t.tidbitsGeo.tooltip&&(t.tidbitsGeo.tooltip.config.edgeMargin.top=t.getTooltipTopMargin(e))})}},{key:"generateMarkerSizeScales",value:function(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r=this.sizeScaleParams,n=e.map(function(t){return t.value}),o=[Math.min.apply(Math,I(n)),Math.max.apply(Math,I(n))],i=r.range,a=e.map(function(t){return t.value}).sort(function(t,e){return t-e}),s=i[0]+(i[1]-i[0])*(r.RT/100);if(r.useTopN){var l=Math.max(0,a.length-r.topN);t=a[l],this.markerSizeTopSet=a.slice(-r.topN)}else t=Math.round(T.quantile(a,r.DT/100)),this.markerSizeTopSet=a.filter(function(e){return e>=t});this.markerSizeTopScaleFn=T.scalePow().exponent(r.exponent).domain([t,o[1]]).range([s,i[1]]),this.markerSizeBottomScaleFn=T.scaleLinear().domain([o[0],t]).range([i[0],s]),this.markerScalingRange=T.scaleLinear().domain([o[0],o[1]]).range([700,1400])}},{key:"generateMarkerColorScales",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=this.colorScaleParams.colors,r=[],n=t.map(function(t){return t.value}).sort(function(t,e){return t-e});e.forEach(function(t){if("number"==typeof t.percentile){var e=T.quantile(n,(100-t.percentile)/100);r.push(e)}}),this.colorPercentiles=r}},{key:"getSizeScale",value:function(t){return this.markerSizeTopSet.includes(t)?this.markerSizeTopScaleFn:this.markerSizeBottomScaleFn}},{key:"scaleMarkerSize",value:function(t){return this.getSizeScale(t)(t)}},{key:"scaleMarkerColor",value:function(t){for(var e=this.colorScaleParams.colors,r=0;t<this.colorPercentiles[r];)r++;var n=e[r=Math.min(r,e.length-1)];return{fillColor:n.fill,hoverFillColor:n.hover}}},{key:"scaleDuration",value:function(t){return this.markerScalingRange(t.value)}},{key:"onTooltipMouseEnter",value:function(t){if(t&&t.geoType){var e="city"===t.geoType,r="territory"===t.geoType;(e||r)&&(this.tidbitsGeo.tooltip.populate({id:t.id,name:t.name,value:t.tooltipFormatted},r?"tb-geo__tooltip--land":"tb-geo__tooltip--marker"),this.tidbitsGeo.tooltip.show())}}},{key:"zoomedCountry",set:function(t){var e=this,r=this.zoomSpeed;this.$timeout(function(){t?e.tidbitsGeo.zoomToCountry(t,r):e.tidbitsGeo.zoomToWorld()}),this._zoomedCountry=t},get:function(){return this._zoomedCountry}},{key:"zoomSpeed",set:function(t){this._zoomSpeed=t},get:function(){return this._zoomSpeed||0}},{key:"highlightedMarker",set:function(t){var e=this,r=this._highlightedMarker;this.$timeout(function(){r&&e.tidbitsGeo.unhighlightMarker(r),t&&e.tidbitsGeo.highlightMarker(t)}),this._highlightedMarker=t},get:function(){return this._highlightedMarker}}])&&P(r.prototype,n),o&&P(r,o),e}();C.a.module("artistconnect-ui.deferredGeo",["tidbits-geo"]).component("geoContainer",{templateUrl:"common/deferred/geoContainer.html",bindings:{self:"=",mapConfig:"<",markers:"<",countries:"<",selectedCountry:"<",selectedMarker:"<",sizeScaleParams:"<",colorScaleParams:"<",onSelectCountry:"&",onSelectMarker:"&",zoomedCountry:"<",zoomSpeed:"<",highlightedMarker:"<",mode:"<"},controller:R})},1005:function(t,e){var r,n=window.angular;try{r=n.module(["ng"])}catch(s){r=n.module("ng",[])}var o='<tidbits-geo self="$ctrl.tidbitsGeo" config="$ctrl.mapConfig" markers="$ctrl.markers" countries="$ctrl.countries" selected-country="$ctrl.selectedCountry" selected-marker="$ctrl.selectedMarker" on-select-country="$ctrl.onSelectCountry({ country: country })" on-select-marker="$ctrl.onSelectMarker({ marker: marker })" class="tb-geo">\n</tidbits-geo>\n',i="common/deferred/geoContainer.html",a=n.element(window.document).injector();a?a.get("$templateCache").put(i,o):r.run(["$templateCache",function(t){t.put(i,o)}]),t.exports=o},1019:function(t,e){var r,n=window.angular;try{r=n.module(["ng"])}catch(s){r=n.module("ng",[])}var o='<section overview-section class="overview-state main-content">\n<div class="overview-state__main">\n<div class="overview-state__main-spinner container-spinner" ng-class="{\'container-spinner-active\': $ctrl.isLoading}"></div>\n<div>\n<kpis kpis="$ctrl.kpiData" lang="$ctrl.lang"></kpis>\n<insights insights="$ctrl.insights" localize="$ctrl.localize"></insights>\n<section ng-if="$ctrl.topCountry && $ctrl.enableGeo && !$ctrl.initialLoad" class="overview-state__section overview-state__section--top-country" ng-class="{\'container-spinner-active\': !$ctrl.isLoading && $ctrl.isLoadingCities}">\n<header>\n<h2>{{\'chart.top.country\' | tbLocalize}}: {{$ctrl.topCountry.name}}</h2>\n<a metrics-kit-click="selectPlacesSeeAll" ui-sref="root.artist.places">\n{{\'chart.seeAll\' | tbLocalize}}\n</a>\n</header>\n<figure class="geo__map-container" ng-click="$ctrl.goToCountry()">\n<geo-container ng-if="$ctrl.topCountry && $ctrl.enableGeo" tb-geo="$ctrl.tidbitsGeo" map-config="$ctrl.mapConfig" markers="$ctrl.markers" countries="$ctrl.countries" zoomed-country="$ctrl.zoomedCountry" zoom-speed="$ctrl.zoomSpeed" size-scale-params="$ctrl.sizeScaleParams" color-scale-params="$ctrl.colorScaleParams" mode="\'city\'">\n</geo-container>\n<div class="container-spinner"></div>\n</figure>\n</section>\n<section ng-if="$ctrl.topPlaylists && $ctrl.topPlaylists.length" class="overview-state__section overview-state__section--top-playlists">\n<top-chart header="{{\'chart.top.playlists\' | tbLocalize}}" direction="horizontal" href="root.artist.catalog.drilldown({\n                        drilldown: \'playlists\',\n                        sortKey: \'plays\',\n                        sortOrder: \'desc\'\n                    })" data="$ctrl.topPlaylists" limit="5" icon-type="playlist">\n</top-chart>\n</section>\n<section ng-if="$ctrl.topSongs.length || $ctrl.topShazamCharts.length" class="overview-state__section overview-state__section--top-charts">\n<div class="overview-state__section--top-charts--wrapper">\n<top-chart ng-if="$ctrl.topSongs.length" ng-class="{ \'top-chart--stretch\': $ctrl.stretchTopSongs }" header="{{\'chart.most.played.songs\' | tbLocalize}}" href="root.artist.catalog.drilldown({\n                            drilldown: \'songs\',\n                            sortKey: \'plays\',\n                            sortOrder: \'desc\'\n                        })" data="$ctrl.topSongs" columns="{{ ($ctrl.stretchTopSongs ? 2 : 1) }}" limit="{{ ($ctrl.stretchTopSongs ? 10 : 5) }}" icon-type="song">\n</top-chart>\n<top-chart ng-if="$ctrl.topShazamedSongs.length" class="shazamed-songs" header="{{\'chart.most.shazamed.songs\' | tbLocalize}}" href="root.artist.catalog.drilldown({\n                            drilldown: \'songs\',\n                            sortKey: \'tags\',\n                            sortOrder: \'desc\'\n                        })" data="$ctrl.topShazamedSongs" columns="1" limit="5" icon-type="song">\n</top-chart>\n<top-chart ng-if="$ctrl.topShazamCharts.length" header="{{\'chart.shazamCharts\' | tbLocalize}}" href="root.artist.catalog.charts({\n                            drilldown: \'charts\',\n                            sortKey: \'score\',\n                            sortOrder: \'desc\'\n                        })" data="$ctrl.topShazamCharts" columns="1" direction="\'vertical\'" limit="{{$ctrl.numItems}}" icon-type="charts" display-type="charts">\n</top-chart>\n<top-chart ng-if="$ctrl.topVideos.length" header="{{\'chart.most.played.videos\' | tbLocalize}}" direction="{{ ($ctrl.topShazamCharts && $ctrl.topShazamCharts.length) ? \'vertical\' : \'horizontal\' }}" href="root.artist.catalog.drilldown({\n                            drilldown: \'videos\',\n                            sortKey: \'plays\',\n                            sortOrder: \'desc\'\n                        })" data="$ctrl.topVideos" columns="1" limit="{{$ctrl.numItems}}" icon-type="video" ng-class="{ \'video\' : !$ctrl.topShazamCharts || !$ctrl.topShazamCharts.length }">\n</top-chart>\n</div>\n</section>\n</div>\n</div>\n</section>\n',i="states/artist/overview/OverviewComponent.html",a=n.element(window.document).injector();a?a.get("$templateCache").put(i,o):r.run(["$templateCache",function(t){t.put(i,o)}]),t.exports=o},1121:function(t,e,r){"use strict";r.r(e);var n=r(7),o=r.n(n),i=r(0),a=r.n(i),s=r(5),l=r.n(s),c=r(3),u=r.n(c),p=r(8),h=r.n(p),d=r(4),f=r.n(d),g=r(105),m=r.n(g),v=r(11),y=r(1),S=r.n(y),b=(r(1e3),r(1004),r(48)),k=r(47),C=r(9),$=r(54);r(1019);function T(t){return(T="function"==typeof a.a&&"symbol"==typeof o.a?function(t){return typeof t}:function(t){return t&&"function"==typeof a.a&&t.constructor===a.a&&t!==a.a.prototype?"symbol":typeof t})(t)}function w(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),l()(t,n.key,n)}}function _(t,e){return!e||"object"!==T(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function z(t){return(z=f.a?u.a:function(t){return t.__proto__||u()(t)})(t)}function I(t,e){return(I=f.a||function(t,e){return t.__proto__=e,t})(t,e)}var P={margin:{top:0,right:0,bottom:0,left:0},renderers:[{name:"bar",options:{maxWidth:12,borderRadius:.5,maxBorderRadius:4,padding:.6,zeroDataHeight:5}}],axes:[],plugins:[]},M=function(t){function e(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),_(this,z(e).apply(this,arguments))}var r,n,o;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=h()(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&I(t,e)}(e,v["a"]),r=e,o=[{key:"$inject",get:function(){return["$q","$scope","$log","$stateParams","$state","KPIService","TopCountryCitiesService","TimeseriesService","InsightsService","TrendsService","MapService","ShazamChartsService","BaseModel","isSuper","ResponsiveService"]}}],(n=[{key:"$onInit",value:function(){var t=this;this.artistId=this.$stateParams.artistId,this.features=["plays","listeners","song_sales","tags"],this.colors={plays:$.default.ALL_PLAYS,listeners:$.default.ALL_LISTENERS,tags:$.default.ALL_TAGS,song_sales:$.default.ALL_SONG_PURCHASES},this.topCountryCitiesLimit=1e3,this.mapConfig={landConfig:{fillColor:"#ffffff",activeFillColor:"#ffffff",strokeColor:"#e5e5e5",onClick:function(){return t.goToCountry.apply(t,arguments)}},markerConfig:{onClick:function(){return t.goToCity.apply(t,arguments)}}},this.loadId=0,this.isLoading=!0,this.initialLoad=!0,this.markers=[],this.sizeScaleParams={},this.timingRequestIds={loadData:0,getKpis:0,getTopCities:0,getTopSongs:0,getTopVideos:0,getAllInsights:0,getTopPlaylists:0},this.localize=C.default.localize,this.lang=C.default.lang,this.setupWatches(),this.setupResize()}},{key:"buildKpiCollection",value:function(t){var e=this;return t.map(function(t){return{title:e.getTitle(t),type:t.kpiType,value:t.kpiValue?Math.round(t.kpiValue):0,tsData:t.tsData,query:t.query,href:e.$state.href("root.artist.trends",{viewBy:"album_sales"!==t.query.feature?"song":"album",feature:t.query.feature,targetId:t.query.targetId,targetType:t.query.targetType})}})}},{key:"getTitle",value:function(t){return t.fullFeature["count"===t.kpiType?"kpiTitle":"kpiTitle_"+t.kpiType]||t.fullFeature.kpiTitle}},{key:"loadData",value:function(){var t=this,e=function(e){return"reqId"!==e.message&&t.$log.error(e),[]};this.isLoading=!0;var r=++this.timingRequestIds.loadData,n={kpis:this.getKpis().catch(e),topSongs:this.getTopSongs().catch(e),topPlaylists:this.getTopPlaylists().catch(e),topVideos:this.getTopVideos().catch(e),topShazamedSongs:this.getTopShazamedSongs().catch(e),topShazamCharts:this.getShazamCharts().catch(e)};n.insights=this.getAllInsights().catch(e),this.$q.all(n).then(function(e){if(r!==t.timingRequestIds.loadData)throw new Error("reqId");t.kpiData=e.kpis,t.topSongs=t.transformChartResponse(e.topSongs,"song"),t.topShazamedSongs=t.transformChartResponse(e.topShazamedSongs,"song"),t.topPlaylists=t.transformChartResponse(e.topPlaylists,"playlist");t.topVideos=t.transformChartResponse(e.topVideos,"video"),t.insights=e.insights,t.stretchTopSongs=!0,t.stretchTopSongs=!(e.topShazamedSongs&&e.topShazamedSongs.length),t.initialLoad=!1,t.topShazamCharts=e.topShazamCharts}).catch(e).finally(function(){r===t.timingRequestIds.loadData&&(t.isLoading=!1)});var o={topCountry:this.getTopCountry().then(function(e){if(r!==t.timingRequestIds.loadData)throw new Error("reqId");return e&&t.zoomMap(e.countryCode,0),t.topCountry=e,e}).catch(e),topCities:this.getTopCities().catch(e)};this.isLoadingCities=!0,this.$q.all(o).then(function(e){if(r!==t.timingRequestIds.loadData)throw new Error("reqId");var n=e.topCities&&e.topCities[0]?e.topCities[0].countryCode:null;t.markers=t.MapService.transformKpiResponse(e.topCities),t.zoomMap(n,0),t.isLoadingCities=!1}).catch(e)}},{key:"getKpis",value:function(){var t=this,e=this.getPeriod({targets:this.features.map(function(e){return{targetId:t.artistId,targetType:"artist",includeTotal:!0,feature:e}})});return this.TimeseriesService.lookup(e,{hasRawTargets:!0,backfillFullPeriod:!0}).then(function(e){return t.mapKpiFeatures(e)}).then(this.buildKpiCollection.bind(this))}},{key:"getAllInsights",value:function(){return this.InsightsService.getAll(this.artistId,this.$stateParams.startDate,this.$stateParams.period,5)}},{key:"getTopSongs",value:function(){return this.getTopData("song",10,"total")}},{key:"getTopVideos",value:function(){var t=this;return this.KPIService.lookup(this.getPeriod({targets:[{targetType:"artist",targetId:this.artistId,feature:"views",breakout:"video",limit:5,sortKey:"total",sortOrder:"desc"}]}),{hasRawTargets:!0}).then(function(t){return t.results}).catch(function(e){return t.$log.error("Could not fetch video KPI data",e,e.toString()),[]})}},{key:"getTopShazamedSongs",value:function(){var t=this;return this.KPIService.lookup(this.getPeriod({targets:[{targetType:"artist",targetId:this.artistId,feature:"tags",breakout:"song",limit:5,sortKey:"total",sortOrder:"desc"}]}),{hasRawTargets:!0}).then(function(t){return t.results}).catch(function(e){return t.$log.error("Could not fetch shazamed songs KPI data",e,e.toString()),[]})}},{key:"getTopCities",value:function(){return this.getTopData("city",this.topCountryCitiesLimit,"total")}},{key:"getTopPlaylists",value:function(){return this.getTopData("playlist",5,"total")}},{key:"mapKpiFeatures",value:function(t){var e=this,r=k.default.features.filter(function(t){return e.features.includes(t.value)});return(t.results.length<r.length?r.map(function(r){var n=t.results.find(function(t){return t&&t.query&&t.query.feature===r.value});if(n)return n;var o={kpiTotal:0,query:{feature:r.value},values:[{value:0,periodStart:new Date}]};return new e.BaseModel(o)}):t.results).map(function(t){var n=t.query.feature;t.fullFeature=r.find(function(t){return t.value===n});var o=e.reduce(t.values);return t.tsData={data:[{id:n,color:e.colors[n],values:o}],options:{startDate:o[0]?o[0].date:null,endDate:o[o.length-1]?o[o.length-1].date:null,periodStep:e.periodStep},configuration:P},t}).sort(function(t,r){return e.features.indexOf(t.query.feature)-e.features.indexOf(r.query.feature)})}},{key:"reduce",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:31,r=[],n=1;t.length/n>e;)n++;if(1===n)r=t.concat();else{for(var o=[],i=t.concat();i.length;)o.push(i.splice(0,n));o.forEach(function(t){var e=t[0].date,n=t.map(function(t){return t.value||0}).reduce(function(t,e){return t+e},0);n/=t.length,r.push({date:e,value:n})})}return this.periodStep=n,r}},{key:"getTopData",value:function(t,e,r){var n=this,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"desc",i=this.getPeriod({targets:[{targetType:"artist",targetId:this.artistId,feature:"plays",breakout:t,limit:e,sortKey:r,sortOrder:o}]}),a=this.KPIService;return"city"===t&&(i.features="tags,listeners",i.granularity="ltd"===this.$stateParams.period?"monthly":"daily",a=this.TopCountryCitiesService),a.lookup(i,{hasRawTargets:!0}).then(function(t){return t.results}).catch(function(e){return n.$log.error("Could not fetch ".concat(t," KPI data"),e,e.toString()),[]})}},{key:"getTopCountry",value:function(){return this.getTopData("territory",1,"total").then(function(t){return t&&t.length?t[0]:null})}},{key:"getPeriod",value:function(t){return this.$stateParams.startDate&&(t.startDate=this.$stateParams.startDate),t.period=this.$stateParams.period,t}},{key:"transformVideoResponse",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return e.forEach(function(e){e.href="^.trends",e.stateParams={viewBy:"video",feature:"views",targetId:t.currentArtist.id,targetType:"artist",rows:e.query.targetId,sortKey:"total",sortOrder:"desc"}}),e}},{key:"transformChartResponse",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"song";return t.map(function(t){return t.href="^.catalog.details",t.stateParams={contentType:e,contentId:t.query.targetId},t})}},{key:"getShazamCharts",value:function(){var t=this;return this.ShazamChartsService.getArtistCharts({artistId:this.currentArtist.id,limit:5}).then(function(e){return e.forEach(function(t){0===t.meta.geo.id?(t.href="root.artist.catalog.chart.global",t.stateParams={contentType:"chart",contentId:t.songId,sortKey:"score",sortOrder:"desc"}):(t.href="root.artist.catalog.chart.global",t.stateParams={contentType:"chart",contentId:t.songId,countryAnchor:t.meta.geo.territory,sortKey:"score",sortOrder:"desc"})}),e&&e.length>0&&t.$scope.$emit("SHAZAM_CHART_BANNER_ON",e),e})}},{key:"zoomMap",value:function(t,e){t&&(this.zoomSpeed=e,this.zoomedCountry=t)}},{key:"goToCity",value:function(t,e){e.stopPropagation();var r=m()(["datum","meta","geo","id"])(t);b.default.recordClickEvent(null,{actionType:"selectCityTopCountry",actionValue:r}),this.$state.go("root.artist.places",{feature:"top",targetId:this.artistId,targetType:"artist",breakout:"city",territory:this.topCountry.countryCode,city:r})}},{key:"goToCountry",value:function(){b.default.recordClickEvent(null,{actionType:"selectTopCountry",actionValue:this.topCountry.countryCode}),this.$state.go("root.artist.places",{feature:"top",targetId:this.artistId,targetType:"artist",breakout:"city",territory:this.topCountry.countryCode})}},{key:"setupResize",value:function(){var t=this,e=function(t){return!["small","medium"].includes(t)};this.enableGeo=e(this.ResponsiveService.getMinWidthName()),this.ResponsiveService.onResize(function(r,n){t.enableGeo=e(n),t.refreshGeo()})}},{key:"refreshGeo",value:function(){this.topCountry&&this.zoomMap(this.topCountry.countryCode,0)}},{key:"setupWatches",value:function(){var t=this;this.$scope.$watch(function(){return[t.$state.params.startDate,t.$state.params.period]},function(e){t.periodStep=1,e[1]&&t.loadData()},!0)}},{key:"numItems",get:function(){return this.topShazamCharts&&this.topShazamCharts.length&&this.topVideos&&this.topVideos.length?Math.min(5,this.topVideos.length,this.topShazamCharts.length):this.topShazamCharts&&this.topShazamCharts.length?Math.min(4,this.topShazamCharts.length):5}}])&&w(r.prototype,n),o&&w(r,o),e}();e.default=S.a.module("artistconnect-ui.overview",["artistconnect-ui.deferredTimeseries","artistconnect-ui.deferredGeo"]).component("overviewComponent",{templateUrl:"states/artist/overview/OverviewComponent.html",controller:M,bindings:{browserTitle:"<",currentArtist:"<"}})}}]);