/*! artistconnect-ui#2042.9.0 */
(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{1004:function(t,e,i){"use strict";var r=i(7),n=i.n(r),o=i(0),a=i.n(o),s=i(57),l=i.n(s),c=i(58),u=i.n(c),h=i(29),p=i.n(h),d=i(5),g=i.n(d),f=i(3),y=i.n(f),m=i(8),v=i.n(m),b=i(4),k=i.n(b),$=i(1),C=i.n($),w=i(11),S=i(72),T=i(1011),_=i.n(T);i(1005);function M(t){return(M="function"==typeof a.a&&"symbol"==typeof n.a?function(t){return typeof t}:function(t){return t&&"function"==typeof a.a&&t.constructor===a.a&&t!==a.a.prototype?"symbol":typeof t})(t)}function z(t){return function(t){if(p()(t)){for(var e=0,i=new Array(t.length);e<t.length;e++)i[e]=t[e];return i}}(t)||function(t){if(u()(Object(t))||"[object Arguments]"===Object.prototype.toString.call(t))return l()(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function D(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),g()(t,r.key,r)}}function I(t,e){return!e||"object"!==M(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function L(t){return(L=k.a?y.a:function(t){return t.__proto__||y()(t)})(t)}function N(t,e){return(N=k.a||function(t,e){return t.__proto__=e,t})(t,e)}_()(C.a,S);var P=function(t){function e(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),I(this,L(e).apply(this,arguments))}var i,r,n;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=v()(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&N(t,e)}(e,w["a"]),i=e,n=[{key:"$inject",get:function(){return["$log","$scope","$stateParams","$state","KPIService","MapService","$timeout"]}}],(r=[{key:"$onInit",value:function(){var t=this,e=[2,15];this.mapConfig=C.a.merge({assetRoot:"/a/static/maps",scale:180,markerConfig:{activeFillColor:"#D60017",fillColor:"#c1e98d",enterMs:750,size:e,easeScale:"easeQuadInOut",sizeScale:this.scaleMarkerSize.bind(this),colorScale:this.scaleMarkerColor.bind(this),durationScale:function(e){return t.scaleDuration(e)}},tooltipConfig:{onMouseEnter:function(e){return t.onTooltipMouseEnter(e)},edgeMargin:{top:this.getTooltipTopMargin(this.mode),left:0,bottom:0,right:0},debugBoxes:!1},zoomConfig:{zoomMs:1750,zoomByButtonMs:50,zoomRangeRestriction:[1,100]}},this.mapConfig),this.sizeScaleParams=C.a.merge({range:e,RT:35,DT:90,topN:10,useTopN:!0,exponent:1},this.sizeScaleParams),this.colorScaleParams=C.a.merge({colors:[{fill:"rgba(2,155,186,0.9)",hover:"rgba(2,155,186,1)",percentile:1},{fill:"rgba(5,159,189,0.8)",hover:"rgba(5,159,189,1)",percentile:2},{fill:"rgba(5,156,189,0.7)",hover:"rgba(5,156,189,1)",percentile:3},{fill:"rgba(23,170,199,0.7)",hover:"rgba(23,170,199,1)",percentile:5},{fill:"rgba(34,194,227,0.7)",hover:"rgba(34,194,227,1)",percentile:8},{fill:"rgba(9,182,217,0.5)",hover:"rgba(9,182,217,1)",percentile:13},{fill:"rgba(9,182,217,0.4)",hover:"rgba(9,182,217,1)",percentile:21},{fill:"rgba(9,182,217,0.4)",hover:"rgba(9,182,217,1)",percentile:34},{fill:"rgba(9,182,217,0.4)",hover:"rgba(9,182,217,1)",percentile:55},{fill:"rgba(9,182,217,0.3)",hover:"rgba(9,182,217,1)",percentile:100}]},this.colorScaleParams),this.setupWatches()}},{key:"getTooltipTopMargin",value:function(t){var e=50;return"territory"!==t&&(e=400),e}},{key:"setupWatches",value:function(){var t=this;this.$scope.$watch("$ctrl.markers",function(e){t.generateMarkerSizeScales(e),t.generateMarkerColorScales(e)}),this.$scope.$watch("$ctrl.mode",function(e){t.tidbitsGeo&&t.tidbitsGeo.tooltip&&(t.tidbitsGeo.tooltip.config.edgeMargin.top=t.getTooltipTopMargin(e))})}},{key:"generateMarkerSizeScales",value:function(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],i=this.sizeScaleParams,r=e.map(function(t){return t.value}),n=[Math.min.apply(Math,z(r)),Math.max.apply(Math,z(r))],o=i.range,a=e.map(function(t){return t.value}).sort(function(t,e){return t-e}),s=o[0]+(o[1]-o[0])*(i.RT/100);if(i.useTopN){var l=Math.max(0,a.length-i.topN);t=a[l],this.markerSizeTopSet=a.slice(-i.topN)}else t=Math.round(S.quantile(a,i.DT/100)),this.markerSizeTopSet=a.filter(function(e){return e>=t});this.markerSizeTopScaleFn=S.scalePow().exponent(i.exponent).domain([t,n[1]]).range([s,o[1]]),this.markerSizeBottomScaleFn=S.scaleLinear().domain([n[0],t]).range([o[0],s]),this.markerScalingRange=S.scaleLinear().domain([n[0],n[1]]).range([700,1400])}},{key:"generateMarkerColorScales",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=this.colorScaleParams.colors,i=[],r=t.map(function(t){return t.value}).sort(function(t,e){return t-e});e.forEach(function(t){if("number"==typeof t.percentile){var e=S.quantile(r,(100-t.percentile)/100);i.push(e)}}),this.colorPercentiles=i}},{key:"getSizeScale",value:function(t){return this.markerSizeTopSet.includes(t)?this.markerSizeTopScaleFn:this.markerSizeBottomScaleFn}},{key:"scaleMarkerSize",value:function(t){return this.getSizeScale(t)(t)}},{key:"scaleMarkerColor",value:function(t){for(var e=this.colorScaleParams.colors,i=0;t<this.colorPercentiles[i];)i++;var r=e[i=Math.min(i,e.length-1)];return{fillColor:r.fill,hoverFillColor:r.hover}}},{key:"scaleDuration",value:function(t){return this.markerScalingRange(t.value)}},{key:"onTooltipMouseEnter",value:function(t){if(t&&t.geoType){var e="city"===t.geoType,i="territory"===t.geoType;(e||i)&&(this.tidbitsGeo.tooltip.populate({id:t.id,name:t.name,value:t.tooltipFormatted},i?"tb-geo__tooltip--land":"tb-geo__tooltip--marker"),this.tidbitsGeo.tooltip.show())}}},{key:"zoomedCountry",set:function(t){var e=this,i=this.zoomSpeed;this.$timeout(function(){t?e.tidbitsGeo.zoomToCountry(t,i):e.tidbitsGeo.zoomToWorld()}),this._zoomedCountry=t},get:function(){return this._zoomedCountry}},{key:"zoomSpeed",set:function(t){this._zoomSpeed=t},get:function(){return this._zoomSpeed||0}},{key:"highlightedMarker",set:function(t){var e=this,i=this._highlightedMarker;this.$timeout(function(){i&&e.tidbitsGeo.unhighlightMarker(i),t&&e.tidbitsGeo.highlightMarker(t)}),this._highlightedMarker=t},get:function(){return this._highlightedMarker}}])&&D(i.prototype,r),n&&D(i,n),e}();C.a.module("artistconnect-ui.deferredGeo",["tidbits-geo"]).component("geoContainer",{templateUrl:"common/deferred/geoContainer.html",bindings:{self:"=",mapConfig:"<",markers:"<",countries:"<",selectedCountry:"<",selectedMarker:"<",sizeScaleParams:"<",colorScaleParams:"<",onSelectCountry:"&",onSelectMarker:"&",zoomedCountry:"<",zoomSpeed:"<",highlightedMarker:"<",mode:"<"},controller:P})},1005:function(t,e){var i,r=window.angular;try{i=r.module(["ng"])}catch(s){i=r.module("ng",[])}var n='<tidbits-geo self="$ctrl.tidbitsGeo" config="$ctrl.mapConfig" markers="$ctrl.markers" countries="$ctrl.countries" selected-country="$ctrl.selectedCountry" selected-marker="$ctrl.selectedMarker" on-select-country="$ctrl.onSelectCountry({ country: country })" on-select-marker="$ctrl.onSelectMarker({ marker: marker })" class="tb-geo">\n</tidbits-geo>\n',o="common/deferred/geoContainer.html",a=r.element(window.document).injector();a?a.get("$templateCache").put(o,n):i.run(["$templateCache",function(t){t.put(o,n)}]),t.exports=n},1036:function(t,e){var i,r=window.angular;try{i=r.module(["ng"])}catch(s){i=r.module("ng",[])}var n='<section class="main-content main-content--geo">\n<div class="geo-state geo-state" ng-class="{\'container-spinner-active\': $ctrl.isLoading}">\n<header ng-if="$ctrl.mapReady" id="geo-state__header" class="geo-state__header">\n<tidbits-chip ng-if="$ctrl.enableMap && $ctrl.chipTitle" self="$ctrl.tidbitsChip" content="{{$ctrl.chipTitle}}" destroy-on-delete="false" on-delete="$ctrl.chipConfig.onChipDelete">\n</tidbits-chip>\n<div ng-if="!$ctrl.enableMap" class="geo-state__header__mobile">\n<button ng-show="$ctrl.mapReady && $ctrl.$state.params.territory" ng-click="$ctrl.onBackNav()" class="geo-state__back-nav tb-btn--disabled-quiet tb-icon--left">\n</button>\n<h2 class="$ctrl.currentLand">{{$ctrl.chipTitle}}</h2>\n<ul class="geo-state__view-toggle">\n<li ng-if="!$ctrl.currentLand" class="tb-btn" ng-repeat="option in $ctrl.geoNav.secondary.options" ng-class="{\'tb-btn--filled\': $ctrl.selectedNav === option}" ng-click="$ctrl.selectedNav = option">\n{{option.title}}\n</li>\n</ul>\n</div>\n</header>\n<div class="container-spinner"></div>\n<figure id="geo__map-container" ng-if="$ctrl.enableMap" class="geo__map-container">\n<button ng-show="$ctrl.mapReady && $ctrl.$state.params.territory" ng-click="$ctrl.onBackNav()" class="geo-state__back-nav tb-btn--disabled-quiet tb-icon--left">\n</button>\n<geo-container map-config="$ctrl.mapConfig" markers="$ctrl.currentData.cities" countries="$ctrl.currentData.territories" selected-country="$ctrl.currentLand.id" selected-marker="$ctrl.currentCity.id" on-select-country="$ctrl.onSelectCountry(country)" on-select-marker="$ctrl.onSelectMarker(marker)" size-scale-params="$ctrl.sizeScaleParams" highlighted-marker="$ctrl.highlightedMarker" zoomed-country="$ctrl.zoomedCountry" color-scale-params="$ctrl.colorScaleParams" mode="$ctrl.mapMode" aria-hidden="true">\n</geo-container>\n<nav class="geo__nav-container">\n<ul class="geo__nav-container__list">\n<li>\n<geo-nav-dropdown options="$ctrl.geoNav.tertiary.options" selected="$ctrl.selectedViewby">\n</geo-nav-dropdown>\n</li>\n<li>\n<geo-nav-dropdown ng-class="{\'geo-nav__dropdown--fadeout\': $ctrl.$state.params.territory }" options="$ctrl.geoNav.secondary.options" selected="$ctrl.selectedNav">\n</geo-nav-dropdown>\n</li>\n</ul>\n</nav>\n</figure>\n<geo-tables data="$ctrl.charts" selected-feature="$ctrl.$state.params.viewBy" ng-show="!$ctrl.isLoading && $ctrl.charts"></geo-tables>\n<insights insights="$ctrl.insights" localize="$ctrl.TidbitsL10nService.localize" ng-show="!$ctrl.isLoading && $ctrl.insights"></insights>\n</div>\n</section>\n',o="states/artist/geo/GeoComponent.html",a=r.element(window.document).injector();a?a.get("$templateCache").put(o,n):i.run(["$templateCache",function(t){t.put(o,n)}]),t.exports=n},1037:function(t,e,i){"use strict";i.r(e);var r=i(7),n=i.n(r),o=i(0),a=i.n(o),s=i(5),l=i.n(s),c=i(3),u=i.n(c),h=i(8),p=i.n(h),d=i(4),g=i.n(d),f=i(67),y=i.n(f),m=i(15),v=i.n(m),b=i(1),k=i.n(b),$=i(11),C=(i(1038),i(47));function w(t){return(w="function"==typeof a.a&&"symbol"==typeof n.a?function(t){return typeof t}:function(t){return t&&"function"==typeof a.a&&t.constructor===a.a&&t!==a.a.prototype?"symbol":typeof t})(t)}function S(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),l()(t,r.key,r)}}function T(t,e){return!e||"object"!==w(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function _(t){return(_=g.a?u.a:function(t){return t.__proto__||u()(t)})(t)}function M(t,e){return(M=g.a||function(t,e){return t.__proto__=e,t})(t,e)}var z=function(t){function e(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),T(this,_(e).apply(this,arguments))}var i,r,n;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=p()(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&M(t,e)}(e,$["a"]),i=e,n=[{key:"$inject",get:function(){return["$scope","$state","$transitions","$window","$timeout","TidbitsL10nService","isSuper"]}}],(r=[{key:"$onInit",value:function(){var t={all:["plays","listeners","tags"],plays:["plays"],listeners:["listeners"],tags:["tags"]};this.sortOrder={songs:"desc"},this.sortKey={songs:"plays"},this.isSorting={songs:!1},this.limit=5,this.features=v()(t).reduce(function(e,i){return e[i]=y()(t[i].map(function(t){return C.default.features.find(function(e){return e.value===t})})),e},{}),this.drilldowns={song:"songs",territory:"territories",city:"cities"}}},{key:"transformData",value:function(t,e){var i=this;return t&&t.forEach(function(t){var r=[];t.data=t.data.slice(0,i.limit).map(function(n){if("songs"===e&&n.meta&&n.meta.song){var o=0,a=0;"all"===i.selectedFeature&&n.features&&n.features.tags?a=n.features.tags.kpiTotal:"tags"===i.selectedFeature&&(a=n.kpiTotal),"all"===i.selectedFeature&&n.features&&n.features.listeners?"count"===n.features.listeners.kpiType?(o=n.features.listeners.kpiTotal,i.features[i.selectedFeature][1].title=i.features[i.selectedFeature][1].kpiTitle):(o=n.features.listeners.kpiAverage,i.features[i.selectedFeature][1].title=i.features[i.selectedFeature][1]["kpiTitle_"+n.features.listeners.kpiType]):"listeners"===i.selectedFeature&&("count"===n.kpiType?(o=n.kpiTotal,i.features[i.selectedFeature][0].title=i.features[i.selectedFeature][0].kpiTitle):(o=n.kpiAverage,i.features[i.selectedFeature][0].title=i.features[i.selectedFeature][0]["kpiTitle_"+n.kpiType])),(n._total||a||o)&&r.push({id:n.id,title:n.title,artwork:n.meta.song.contentGroupArtwork,tags:a,listeners:o,plays:n._total?n._total:0,header:n.header,geoType:t.iconType,meta:n.meta,targetId:n.query.targetId})}return"videos"===e&&(n.views=n.plays),n}),t.rows=r,t.href=i.$state.href("root.artist.placesDrilldown",{drilldown:i.drilldowns[t.iconType],territory:i.$state.params.territory,city:i.$state.params.city})}),t}},{key:"data",set:function(t){t&&(this.columnCount=t.length>1?1:2,this.columnClass=t.length>1?"tb-col--medium-12":"tb-col--medium-24",this._data=this.transformData(t,"songs"))},get:function(){return this._data}}])&&S(i.prototype,r),n&&S(i,n),e}();k.a.module("artistconnect-ui.geo").component("geoTables",{controller:z,templateUrl:"states/artist/geo/GeoTablesComponent.html",bindings:{data:"<",selectedFeature:"<"}})},1038:function(t,e){var i,r=window.angular;try{i=r.module(["ng"])}catch(s){i=r.module("ng",[])}var n='<figcaption class="tb-row geo__topchart-container">\n<div ng-repeat="column in $ctrl.data" ng-animate-swap="column.id" ng-show="column.data.length > 0" class="top-charts top-chart__wrapper">\n<header ng-if="column.rows && column.rows.length > 0">\n<h2 ng-if="column.header" class="top-charts__header">{{column.header}}</h2>\n<a ng-if="column.href" href="{{column.href}}" class="top-chart__see-all">\n{{\'chart.seeAll\' | tbLocalize}}\n</a>\n</header>\n<catalog-table ng-if="column.rows && column.rows.length > 0" icon-type="{{column.iconType}}" features="$ctrl.features[$ctrl.selectedFeature]" is-clickable="column.iconType === \'city\' || column.iconType === \'territory\'" is-sortable="false" on-header-click="" on-row-click="column.onItemClick" on-row-mouseover="column.onItemMouseover" on-row-mouseleave="column.onItemMouseleave" rows="column.rows" sort-key="$ctrl.sortKey.songs" sort-order="$ctrl.sortOrder.songs" title="{{\'catalog.title.\' + column.iconType | tbLocalize}}" section="songs" show-album="true">\n</catalog-table>\n</div>\n</figcaption>\n',o="states/artist/geo/GeoTablesComponent.html",a=r.element(window.document).injector();a?a.get("$templateCache").put(o,n):i.run(["$templateCache",function(t){t.put(o,n)}]),t.exports=n},1123:function(t,e,i){"use strict";i.r(e);var r=i(7),n=i.n(r),o=i(0),a=i.n(o),s=i(5),l=i.n(s),c=i(3),u=i.n(c),h=i(8),p=i.n(h),d=i(4),g=i.n(d),f=i(21),y=i.n(f),m=i(13),v=i.n(m),b=i(15),k=i.n(b),$=i(1),C=i.n($),w=i(11);i(1004),i(1036);function S(t){return(S="function"==typeof a.a&&"symbol"==typeof n.a?function(t){return typeof t}:function(t){return t&&"function"==typeof a.a&&t.constructor===a.a&&t!==a.a.prototype?"symbol":typeof t})(t)}function T(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),l()(t,r.key,r)}}function _(t,e){return!e||"object"!==S(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function M(t){return(M=g.a?u.a:function(t){return t.__proto__||u()(t)})(t)}function z(t,e){return(z=g.a||function(t,e){return t.__proto__=e,t})(t,e)}var D=function(t){function e(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),_(this,M(e).apply(this,arguments))}var i,r,n;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=p()(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&z(t,e)}(e,w["a"]),i=e,n=[{key:"$inject",get:function(){return["$scope","$q","$state","$log","$document","$timeout","MapService","TidbitsL10nService","isSuper","ResponsiveService","InsightsService"]}}],(r=[{key:"$onInit",value:function(){var t=this;this.startDate=this.$state.params.startDate,this.period=this.$state.params.period,this.viewBy=this.$state.params.viewBy,this.mapReady=!1,this.feature=this.$state.params.feature,this.mapConfig={landConfig:{fillColor:"#dbdada",hoverFillColor:"#d3d2d2",activeFillColor:"#cbcaca",activeStrokeColor:"#ffffff",strokeColor:"#ffffff"},zoomConfig:{addZoomButtons:!0,panOnMouseDrag:!0,onZoomStart:this.onZoomStart.bind(this)},markerConfig:{}},this.sizeScaleParams={},this.colorScaleParams={},this.chipConfig={onChipDelete:function(e){return t.onChipDelete(e)}},this.worldKpi={cities:[],territories:[],songs:[],markers:[]},this.pagination={limitInCountry:1e3,limitInWorld:3e3,offset:0},this.setupNav(),this.setupResponsive(),this.loadPage(!0),this.stateId=0}},{key:"loadPage",value:function(){var t=this;if(!(arguments.length>0&&void 0!==arguments[0]&&arguments[0]))return this.loadState();this.mapReady||this.$timeout(function(){return t.initZoom()}),this.isLoading=!0;var e={top:function(){return{cities:t.getKpiData("city"),territories:t.getKpiData("territory"),songs:t.getKpiData("song",{limit:5}),topoCountries:t.MapService.loadTopoCountries()}},popular:function(){return{cities:t.getPopularData("city"),territories:t.getPopularData("territory"),topoCountries:t.MapService.loadTopoCountries()}}};return this.$q.all(e[this.feature]()).then(function(e){t.worldKpi={cities:e.cities,territories:C.a.copy(e.territories.filter(function(t){return e.topoCountries.includes(t.id)})),territoriesWithColors:t.MapService.assignCountryFillColor(e.territories.filter(function(t){return e.topoCountries.includes(t.id)})),songs:e.songs,insights:e.insights},t.allCountries=e.territories}).then(function(){return t.loadState()}).catch(function(e){t.$log.error(e)}).finally(function(){t.isLoading=!1,t.mapReady=!0})}},{key:"loadState",value:function(){var t,e=this,i=++this.stateId;return this.isLoading=!0,this.selectedNav=this._lookUpSelectedNav(this.$state.params.breakout),this.selectedViewby=this._lookUpSelectedViewby(this.$state.params.viewBy),this.insights=null,(t=this.$state.params.city&&this.$state.params.territory?this.selectCityMarkerState(i,this.$state.params.territory,this.$state.params.city):this.$state.params.territory?this.selectCountryState(i,this.$state.params.territory):"city"===this.$state.params.breakout?this.selectWorldCitiesState(i):this.selectWorldState(i)).finally(function(){i===e.stateId&&(e.isLoading=!1)}),t}},{key:"initZoom",value:function(){var t=this;this.$state.params.territory&&this.$timeout(function(){t.zoomTo(t.$state.params.territory)})}},{key:"setupNav",value:function(){this.geoNav={primary:{options:[{id:"top",title:this.TidbitsL10nService.localize("geo.nav.plays"),value:"top"},{id:"popular",title:this.TidbitsL10nService.localize("geo.nav.popular"),value:"popular"}]},secondary:{options:[{id:"territory",title:this.TidbitsL10nService.localize("geo.nav.area"),value:"territory"},{id:"city",title:this.TidbitsL10nService.localize("geo.nav.city"),value:"city"}]},tertiary:{options:[{id:"all",title:this.TidbitsL10nService.localize("geo.nav.all"),value:"all"},{id:"plays",title:this.TidbitsL10nService.localize("geo.nav.plays"),value:"plays"},{id:"listeners",title:this.TidbitsL10nService.localize("geo.nav.listeners"),value:"listeners"},{id:"tags",title:this.TidbitsL10nService.localize("geo.nav.tags"),value:"tags"}]}},this.selectedNav=this._lookUpSelectedNav(this.$state.params.breakout),this.selectedViewby=this._lookUpSelectedViewby(this.$state.params.viewBy)}},{key:"getTerritory",value:function(){return this.$state.params.territory}},{key:"uiOnParamsChanged",value:function(t){var e=["startDate","period","viewBy"],i=k()(t).some(function(t){return e.includes(t)});i&&(this.startDate=this.$state.params.startDate,this.period=this.$state.params.period,this.viewBy=this.$state.params.viewBy),this.loadPage(i)}},{key:"selectWorldState",value:function(t){var e=this;return this.currentData={cities:[],songs:this.worldKpi.songs,territories:this.worldKpi.territoriesWithColors},this.charts=this.getCharts("worldCountry"),this.$timeout(function(){t===e.stateId&&(e.zoomedCountry=null)},200)}},{key:"selectWorldCitiesState",value:function(t){var e=this;return this.currentData={cities:this.worldKpi.cities,songs:this.worldKpi.songs,territories:[]},this.charts=this.getCharts("worldCity"),this.$timeout(function(){t===e.stateId&&(e.zoomedCountry=null)},200)}},{key:"selectCountryState",value:function(t,e){var i=this;if(this.currentData=v()({},this.currentData,{territories:this.worldKpi.territories}),e){var r={top:function(){return{cities:i.getKpiData("city",{territories:[e]}),songs:i.getKpiData("song",{territories:[e],limit:5}),insights:i.getInsights(e)}},popular:function(){return{cities:i.getPopularData("city",{territories:[e]})}}};return this.$q.all(r[this.feature]()).then(function(e){i.stateId===t&&(i.currentData={cities:e.cities,songs:e.songs,territories:[]},i.charts=i.getCharts("country"))})}return y.a.reject(new Error("isoCode3: ".concat(e)))}},{key:"selectCityMarkerState",value:function(t,e,i){var r,n=this;return r={cities:n.getKpiData("city",{territories:[e]}),songs:n.getKpiData("song",{city:i,limit:5}),insights:n.getInsights(e)},n.$q.all(r).then(function(e){n.stateId===t&&(n.unhighlightMarker(),n.currentData=v()({},n.currentData,{cities:e.cities,songs:e.songs}),n.charts=n.getCharts("city"))})}},{key:"selectCountry",value:function(t){return t?this.$state.go(".",{territory:t.id,city:null}):this.$state.go(".",{territory:null,city:null})}},{key:"selectCity",value:function(t){if(!t)return this.$state.go(".",{city:null});var e=t.meta.geo.id,i=t.meta.geo.countryCode;return this.$state.go(".",{city:e,territory:i})}},{key:"zoomTo",value:function(t){this.zoomSpeed=this.mapReady?0:300,this.zoomedCountry=t}},{key:"onNavSelect",value:function(t){return this.$state.go(".",{breakout:t.value})}},{key:"onViewbySelect",value:function(t){return this.$state.go(".",{viewBy:t.value})}},{key:"onBackNav",value:function(){this.$state.params.city?this.$state.go(".",{city:null}):this.$state.params.territory&&this.$state.go(".",{territory:null})}},{key:"onZoomStart",value:function(){this.scrollToTop()}},{key:"onSelectCountry",value:function(t){return this.selectCountry(t)}},{key:"onSelectMarker",value:function(t){var e=t?t.datum:null;return this.selectCity(e)}},{key:"onChipDelete",value:function(){this.$state.params.city?this.$state.go(".",{city:null}):this.$state.params.territory&&this.$state.go(".",{territory:null})}},{key:"onTopChartClick",value:function(t){"territory"===t.geoType?this.selectCountry(t):"city"===t.geoType?(this.onTopChartMouseleave(t),this.selectCity(t)):this.$state.go("root.artist.catalog.details",{contentType:"song",contentId:t.targetId}),this.scrollToTop()}},{key:"onTopChartMouseover",value:function(t){this.highlightMarker(t)}},{key:"onTopChartMouseleave",value:function(t){this.unhighlightMarker(t)}},{key:"highlightMarker",value:function(t){this.highlightedMarker=t.id}},{key:"unhighlightMarker",value:function(){this.highlightedMarker=null}},{key:"getKpiData",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=this._buildKpiQuery(t,e);return this.MapService.getKpiData(i)}},{key:"getInsights",value:function(t){var e=this;if(this.insights=null,this.currentData&&this.currentData.territories){var i=this.currentData.territories.find(function(e){return e.meta.geo.countryCode===t});if(i&&i.meta.geo.id){var r={artistId:this.$state.params.artistId,period:this.$state.params.period,timestamp:this.$state.params.startDate,highlight:5,geoType:"COUNTRY",geoId:i.meta.geo.id};this.InsightsService.getFilteredInsights(r).then(function(t){e.insights=t})}}}},{key:"getPopularData",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=this._buildKpiQuery(t,e);return this.MapService.getPopularData(i)}},{key:"_lookUpSelectedNav",value:function(t){return this.geoNav.secondary.options.find(function(e){return e.id===t})}},{key:"_lookUpSelectedViewby",value:function(t){return this.geoNav.tertiary.options.find(function(e){return e.id===t})}},{key:"_buildKpiQuery",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=v()({},{targetType:"artist",targetId:this.$state.params.artistId,feature:"all"===this.$state.params.viewBy?"plays":this.$state.params.viewBy,breakout:t,limit:e&&e.territories?this.pagination.limitInCountry:this.pagination.limitInWorld,offset:this.pagination.offset},e),r={startDate:this.$state.params.startDate,period:this.$state.params.period,targets:[i]};return"all"!==this.$state.params.viewBy||"song"!==t&&"city"!==t&&"territory"!==t?"listeners"===this.$state.params.viewBy&&(r.granularity="ltd"===this.$state.params.period?"monthly":"daily"):(r.features="tags",r.features="tags,listeners",r.granularity="ltd"===this.$state.params.period?"monthly":"daily"),r}},{key:"scrollToTop",value:function(){this.$document.scrollToElementAnimated(this.$document[0].querySelector(".root-state"),0,750,function(t){return t<.5?16*t*t*t*t*t:1+16*--t*t*t*t*t})}},{key:"getTableHeaders",value:function(){var t=this.chipTitle;return{cities:t?this.TidbitsL10nService.localize("chart.cities.inLocation",{"@@inLocation@@":t}):this.TidbitsL10nService.localize("chart.cities"),territories:this.TidbitsL10nService.localize("chart.countries"),songs:t?this.TidbitsL10nService.localize("chart.songs.inLocation",{"@@inLocation@@":t}):this.TidbitsL10nService.localize("chart.songs.world")}}},{key:"getCharts",value:function(t){var e,i={limit:5},r=this.getTableHeaders();return"worldCountry"===t?e=[v()({},i,{id:"worldTerritories",header:r.territories,data:this.currentData.territories,iconType:"territory",onItemClick:this.onTopChartClick.bind(this)}),v()({},i,{id:"worldSongs",header:r.songs,data:this.currentData.songs,iconType:"song",onItemClick:this.onTopChartClick.bind(this)})]:"worldCity"===t||"country"===t?e=[v()({},i,{id:"".concat(t,"Cities"),header:r.cities,data:this.currentData.cities,iconType:"city",onItemClick:this.onTopChartClick.bind(this),onItemMouseover:this.onTopChartMouseover.bind(this),onItemMouseleave:this.onTopChartMouseleave.bind(this)}),v()({},i,{id:"worldSongs",header:r.songs,data:this.currentData.songs,iconType:"song",onItemClick:this.onTopChartClick.bind(this)})]:"city"===t&&(e=[v()({},i,{id:"citySongs",header:r.songs,data:this.currentData.songs,iconType:"song",onItemClick:this.onTopChartClick.bind(this)})]),e?(e.forEach(function(t){}),e):null}},{key:"setupResponsive",value:function(){var t=this,e=function(t){return!["small","medium"].includes(t)};this.enableMap=e(this.ResponsiveService.getMinWidthName()),this.ResponsiveService.onResize(function(i,r){t.enableMap=e(r)})}},{key:"transformData",value:function(t,e){return t&&t.results&&(t.results=t.results.map(function(t){return t.title=t.name,"playlists"===e&&t.songs&&(t.children=t.songs),"videos"===e&&(t.views=t.plays),t})),t}},{key:"territories",get:function(){return this._territories},set:function(t){this._territories=t}},{key:"charts",set:function(t){this._charts=t},get:function(){return this._charts}},{key:"currentLand",get:function(){var t=this.$state.params.territory;return t?this._currentLand&&this._currentLand.id===t||(this._currentLand=this.worldKpi&&this.worldKpi.territories&&this.worldKpi.territories.find(function(e){return e.id===t})):this._currentLand=null,this._currentLand}},{key:"currentCity",get:function(){var t=this.$state.params.city;return t?this._currentCity&&this._currentCity.id===t||(this._currentCity=this.currentData&&this.currentData.cities&&this.currentData.cities.find(function(e){return e.meta.geo.id===t})):this._currentCity=null,this._currentCity}},{key:"chipTitle",get:function(){var t;return this.currentCity?t=this.currentCity.name:this.currentLand&&(t=this.currentLand.name),this.tidbitsChip&&(t?this.tidbitsChip.show():this.tidbitsChip.hide()),t}},{key:"selectedNav",set:function(t){var e=this._selectedNav;this._selectedNav=t,e&&!C.a.equals(t,e)&&t&&this.onNavSelect(t)},get:function(){return this._selectedNav}},{key:"selectedViewby",set:function(t){var e=this._selectedViewby;this._selectedViewby=t,e&&!C.a.equals(t,e)&&t&&this.onViewbySelect(t)},get:function(){return this._selectedViewby}},{key:"mapMode",get:function(){return"city"===this.$state.params.breakout?"city":"territory"===this.$state.params.breakout&&null!==this.$state.params.territory?"city":"territory"}}])&&T(i.prototype,r),n&&T(i,n),e}();(t=C.a.module("artistconnect-ui.geo",["services","artistconnect-ui.deferredGeo"])).component("geoComponent",{controller:D,templateUrl:"states/artist/geo/GeoComponent.html",bindings:{}}),i(1037),e.default=t}}]);